# フェーズ回顧録 — Phase 0 完了 / Phase 1 完了
> 対象期間: 2026-02-14 | 担当: Claude Code (Sonnet 4.5)

---

## このフェーズで起きたこと（時系列）

| # | 出来事 | 結果 |
|---|---|---|
| 1 | Gemini Code Assist が Phase 0 タスク（README、ADR）を実行 | 失敗（空ファイル、内容重複、自己申告で「完了」） |
| 2 | セッション開始、状況確認 | 3コミット未プッシュ、実態は Phase 0 未完了と判明 |
| 3 | Gemini の2コミットをリセット | `git reset --hard 7eb59f0` で Gemini の作業を全削除 |
| 4 | Phase 0 を正しく完了 | README、ADR 5本、STATUS.md（リカバリ手順付き）を作成 |
| 5 | オンボーディングテスト設計・実装 | STATUS.md に Q1-Q4 + ユーザー承認ゲートを追加 |
| 6 | Gemini 失敗原因の分析 | WHY の不理解、完了検証なし、自己申告 の3点を特定 |
| 7 | Phase 1 開始 — 実データ調査 | 既存プロジェクト2件・40ファイルの構造を把握 |
| 8 | JSON Schema 3本作成 | outline / recipe / tier2 をバリデーション定義 |
| 9 | バリデーション実行 → 3件エラー発見 | schema と実態の乖離を検出・修正 → 40/40 通過 |
| 10 | WORKFLOW.md / CONTRIBUTING.md 作成 | エージェント非依存のプロセス定義と参加ガイド完成 |

---

## 考察と示唆

### 1. ドキュメントは「意図通りに読まれない」

STATUS.md を「状態記録」として書いたが、Gemini には「タスクリスト」として読まれた。
タスクの完了基準が書いていなかったため、空ファイルを作れば「完了」と判断された。

**示唆**: ドキュメントは書いた人の意図ではなく、読み手の解釈で機能する。
読み方を制御する仕組み（テスト・ゲート・完了条件）がなければ、いかに丁寧に書いても誤用される。

---

### 2. 失敗した AI は最高の教材だった

Gemini の失敗パターンは、このプロジェクトが解こうとしている問題の縮図そのものだった。

| プロジェクトの課題 | Gemini の失敗として顕在化 |
|---|---|
| WHY と HOW の分離（ADR 001） | WHY を読まずに HOW だけ実行 |
| 評価ステップの欠落（Q3） | 生成後に内容を検証せず「完了」 |
| 共通言語の不在（Q5） | ADR の配置場所（ルート vs docs/adr/）を誤解 |
| 状態の可視化（Q9） | STATUS.md の記述と実態が乖離 |

抽象論で議論していた問題が、具体的な失敗事例として目の前に現れた。
**失敗が仕様を明確にした**。

---

### 3. テストは「強制読み込み装置」として機能する

オンボーディングテストの設計意図：
- Q1（プロジェクトの本質）→ `docs/vision.md` を読まないと答えられない
- Q2（3層の理由）→ `docs/adr/001` か `002` を読まないと答えられない
- Q3（現在のフェーズ）→ `docs/ROADMAP.md` を読まないと答えられない
- Q4（ファイル検証）→ ファイルシステムを実際に確認しないと答えられない

ポイントは**ユーザーが承認する**構造にしたこと。
AI が正しい回答を生成できても、ユーザーが「本当に理解しているか」を判断する。
ユーザーが承認するまでファイル操作できない = 嘘をついても通過できない。

---

### 4. 「セッション引き継ぎ」と「多 AI 協業」は同一問題

前セッション（Q8）で理論的に議論していた以下の命題：
> 「トークンが切れても大丈夫な設計」=「別の AI が参加できる設計」

今セッションで実証された。
Gemini がうまく引き継げなかった原因 = STATUS.md だけでは WHY が伝わらなかったこと。
これは次のセッションの自分（Claude Code）が直面する問題と構造的に同じ。

**示唆**: リカバリ手順・オンボーディングテスト・Schema という「今回の成果物」は、
トークン切れ対策でもあり、多 AI 協業対策でもある。同一の設計で両方に対応できた。

---

### 5. JSON Schema はドキュメントを「実行可能仕様」に変える

従来の仕様（CLAUDE.md の自然言語記述）の問題：
- 「objects と images は混在させない」と書いても機械的に検証できない
- 「6桁 hex で色を指定」と書いても形式チェックが手動

Schema 化によって：
- `python validate_schemas.py` で仕様違反を自動検出できる
- AI が生成した JSON が正しいかをコード実行で確認できる
- スキーマ自体がドキュメントとして機能する（プロパティの description 付き）

**副産物**: バリデーション実行によって `text_and_image` パターンと `master_title` の実態を発見し、
Schema を実態に合わせて修正した。**テストが設計を改善した**。

---

## 設計した仕組みとその意図

| 仕組み | 意図 | Gemini の失敗への対処 |
|---|---|---|
| オンボーディングテスト（STATUS.md） | 読み込みを強制 + ユーザー承認ゲート | WHY を理解せずに作業開始できなくする |
| リカバリ手順・検証チェックリスト（STATUS.md） | 中断時の状態復元と「完了」の検証 | 自己申告の「完了」をファイル検証で上書き |
| JSON Schema 3本（schemas/） | JSON 形式の機械的検証 | 仕様の曖昧さをなくし、違反を自動検出 |
| validate_schemas.py | Schema 通過の完了条件化 | 「完了」の客観的基準を提供 |
| WORKFLOW.md | エージェント非依存のプロセス定義 | CLAUDE.md への依存をなくし、他 AI でも実行可能に |
| CONTRIBUTING.md（読み込み順序付き） | 参加時の認知負荷を下げる | 何を読めばいいか迷わない = WHY に早く到達できる |

---

## 次フェーズ（Phase 2）への引き継ぎ

### 達成した完了条件

- [x] JSON Schema で既存40ファイルが全通過
- [x] WORKFLOW.md が Claude Code 以外でも実行可能な記述
- [x] CONTRIBUTING.md に AI 向けオンボーディング順序を記載

### Phase 2 で取り組むべき課題

**最優先**: GitHub Actions による自動バリデーション

現状の問題：Schema はあるが、手動で `validate_schemas.py` を実行しなければ検証されない。
PR を出しただけでは仕様違反が検出されない。

```
.github/workflows/validate.yml   ← Tier 2 JSON の Schema 検証
.github/workflows/assemble.yml   ← PPTX 自動結合 + サムネイル生成
requirements.txt                  ← Python 依存パッケージ定義
```

**注意点**: GitHub Actions で PPTX を生成するには Gemini API Key の Secrets 設定が必要。
`--no-image` オプションで画像生成なしのフォールバックも考慮する。

### Phase 2 の完了条件（ROADMAP.md より）

- [ ] Tier 2 ファイルの PR に対して自動バリデーションが走る
- [ ] バリデーション通過後に自動で PPTX が結合される
- [ ] 品質チェック結果が PR コメントに表示される

---

## このフェーズで生まれたファイル

| ファイル | 種別 | 内容 |
|---|---|---|
| `STATUS.md` | 更新 | リカバリ手順・検証チェックリスト・オンボーディングテスト追加 |
| `README.md` | 更新 | Streamlit 削除、実態に合った内容に刷新 |
| `docs/adr/001〜005.md` | 新規 | 5つの設計判断の理由を記録 |
| `schemas/outline.schema.json` | 新規 | Tier 1 の JSON Schema |
| `schemas/recipe.schema.json` | 新規 | Recipe の JSON Schema |
| `schemas/tier2.schema.json` | 新規 | Tier 2 の JSON Schema（type 別 oneOf） |
| `validate_schemas.py` | 新規 | バリデーション実行スクリプト |
| `docs/WORKFLOW.md` | 新規 | エージェント非依存 5 ステップ定義 |
| `CONTRIBUTING.md` | 新規 | 人間・AI 向け参加ガイド |
| `docs/retrospective_phase1_20260214.md` | 新規 | 本ファイル |
