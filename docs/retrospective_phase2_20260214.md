# フェーズ回顧録 — Phase 2 完了
> 対象期間: 2026-02-14 | 担当: Claude Code (Sonnet 4.5)

---

## このフェーズで起きたこと（時系列）

| # | 出来事 | 結果 |
|---|---|---|
| 1 | Gemini に Phase 2 タスクを依頼（requirements.txt、validate.yml、assemble.yml） | 空ファイル3本をコミット — Phase 1 と同じ「形だけ作る」失敗 |
| 2 | Gemini の STATUS.md 変更を Claude が上書きコミット | ユーザーが未Accept の状態で競合発生 |
| 3 | ユーザーが Gemini をリジェクト + `git restore` で STATUS.md を修正 | 競合解消 |
| 4 | CONTRIBUTING.md に「複数 AI 協業ルール」を追加 | 人間側ルール（Accept 前の明示）を明文化 |
| 5 | Gemini を新規セッションでリトライ → オンボーディングテスト実施 | Q1-Q3 は合格水準、Q4 はファイル名を省略（未検証） |
| 6 | Gemini が CLAUDE.md の Streamlit 記述を発見（Q4 の副産物） | CLAUDE.md の不整合を修正（`start.bat` / `streamlit` 削除） |
| 7 | Gemini が quality.yml を提案（未Accept） | パスバグ2点（`work/slides/`、`working-directory: ./work`）を発見 |
| 8 | Claude が3ワークフロー + requirements.txt を正しく実装 | validate.yml / assemble.yml / quality.yml / requirements.txt 完成 |
| 9 | Phase 2 完了 → STATUS.md 更新・コミット | Phase 3 へ移行 |

---

## 考察と示唆

### 1. Gemini の失敗は「構造を理解しているか」のテストになる

Phase 1 の Gemini は「空ファイルを作れば完了」と判断した。
Phase 2 の Gemini は「パスを推測で書いて提案する」という進化した失敗をした。

| フェーズ | Gemini の失敗パターン | 根本原因 |
|---|---|---|
| Phase 1 | 空ファイルを作成して「完了」と申告 | 完了条件の不理解 |
| Phase 2（第1バッチ） | 空ファイルをコミット | ファイル内容の検証なし |
| Phase 2（第2バッチ） | パスを推測で記述（`work/slides/`） | リポジトリ構造を実際に確認していない |

失敗のパターンが洗練されているが、本質は同じ：**実際に動作を確認しない**。
Q4 でファイル名を省略したことが、yml でパスを推測したことと対応している。
「省略」は「確認しなかった」の言語化されたシグナルである。

---

### 2. オンボーディングテストは「作業能力」ではなく「確認習慣」を測る

前回 Gemini（新セッション）の Q4 回答：
> ADR 003・004 のファイル名を `...` で省略

yml でのパスバグ：
> `work/slides/**/slides/*.json`（`work/` が余分）

どちらも「たぶんこうだろう」という推測で進んでいる。
オンボーディングテストが測れるのは **WHY の理解** だが、
実際の作業品質を保証するのは **確認する習慣** であり、これは別の指標が必要。

**示唆**: Q4 を強化する方向がある。
- 現在: 「〜は存在するか」→ Gemini はファイルシステムに直接アクセスできないため正直に答えれば通過できる
- 改善案: 「〜のファイルの最初の5行を引用せよ」→ 引用できなければ未確認と判断できる
- ただしこれは Gemini の制約（GitHub 上のファイルしか見えない）との兼ね合いがある

---

### 3. 多 AI 協業の「見えない境界」問題

このフェーズで起きた競合の構造：

```
Claude Code                Gemini Code Assist
（ファイルシステム直接操作）    （GitHub経由、Accept/Rejectあり）
        |                         |
        v                         v
    git commit              VSCode UI操作
        |                    （git の外）
        v                         |
    git push ←-------------------+
```

Claude Code の変更は即座に git に入る。
Gemini の変更は VSCode の Accept を経由して初めて git に入る。
**この非対称性が競合の根本原因**。

人間が「まだ Accept していない」を明示するルールを作ったが、
これは根本解決ではなく応急処置である。
将来の理想形（branch + PR）への道が見えている。

---

### 4. ドキュメントの「副産物バグ発見」は再現性がある

Phase 1 では JSON Schema バリデーションが「text_and_image パターン」の未定義を発見した。
Phase 2 では Gemini の Q4 が「CLAUDE.md の Streamlit 記述」を発見した。

どちらも**主目的ではなく、プロセスの副産物として**バグが見つかった。

| フェーズ | 検証の主目的 | 副産物として発見されたバグ |
|---|---|---|
| Phase 1 | 既存 JSON が Schema に通るか | text_and_image / master_title の定義漏れ |
| Phase 2 | Gemini がプロジェクトを理解しているか | CLAUDE.md の削除済み機能（Streamlit）の記述残留 |

**示唆**: 「別の視点からの確認」は常にバグを見つける。
新しいセッション、新しい AI、新しいスキーマ — これらはどれも「別の視点」であり、
主目的以外の発見を生む。定期的な外部視点の導入は意図的に設計すべきである。

---

### 5. 「Gemini に何を任せるか」の境界が見えてきた

| 向いている作業 | 向いていない作業 |
|---|---|
| 既知のフォーマット（YAML、Markdown）をパターンから生成 | パスや構造など、リポジトリの実態を把握する必要がある作業 |
| ドキュメントの読解・要約 | ファイルの存在確認・内容検証 |
| アイデア出し・設計相談 | コマンド実行・バリデーション |
| ルートが GitHub 上にあるタスク | ローカルファイルシステムに依存するタスク |

Gemini の「提案→Accept」モデルは、**変更前に人間がレビューできる**という点で安全側に倒れている。
リスクは低いが、検証コストは人間が負担する構造になっている。

**Claude Code** がファイルシステム直接操作・検証まで完結できるのに対して、
**Gemini** は「設計相談・ドキュメント読解→提案→人間が検証・Accept」の役割が適切。

---

## 設計した仕組みとその意図

| 仕組み | 意図 | Phase 2 での問題への対処 |
|---|---|---|
| 複数 AI 協業ルール（CONTRIBUTING.md） | Accept/Reject の非対称性を人間が補完 | 「まだ Accept していない」の明示を人間側に義務付け |
| Q4 副産物バグ発見の認識 | 外部視点の意図的活用 | 次回以降の Q4 を「引用せよ」形式に強化する候補として認識 |
| quality.yml の PR コメント | バリデーション結果の可視化 | 「検証したことを記録に残す」文化の自動化 |

---

## Phase 2 で生まれたファイル

| ファイル | 種別 | 内容 |
|---|---|---|
| `requirements.txt` | 新規（実装） | Python 依存パッケージ6本 |
| `.github/workflows/validate.yml` | 修正（実装） | Schema 検証（空ファイルから正しい内容に） |
| `.github/workflows/assemble.yml` | 修正（実装） | PPTX 結合ワークフロー（空ファイルから正しい内容に） |
| `.github/workflows/quality.yml` | 新規（実装） | PR コメント付き品質チェック |
| `CONTRIBUTING.md` | 追記 | 複数 AI 協業ルール（AI 向け + 人間向け）|
| `CLAUDE.md` | 修正 | 削除済み機能（Streamlit / start.bat）の記述を削除 |
| `docs/retrospective_phase2_20260214.md` | 新規 | 本ファイル |

---

## Phase 3 への引き継ぎ

### 達成した完了条件

- [x] Tier 2 ファイルの PR に対して自動バリデーションが走る（validate.yml）
- [x] バリデーション通過後に自動で PPTX が結合される（assemble.yml）
- [x] 品質チェック結果が PR コメントに表示される（quality.yml）

### Phase 3 で取り組むべき課題

**Phase 3: 参照ライブラリ** — 既存スライドのパターンをカタログ化し、再利用可能な形で整備する。

詳細は [docs/ROADMAP.md](ROADMAP.md) の Phase 3 セクションを参照。

### 多 AI 協業の改善候補（Phase 3 以降）

1. **Q4 強化**: 「ファイルが存在するか」→「ファイルの最初の5行を引用せよ」
2. **branch + PR 運用**: Gemini の変更を PR 経由にすることで競合を git の中で解決
3. **Gemini への役割明確化**: 設計相談・ドキュメント読解に特化させ、実装は Claude Code が担当
